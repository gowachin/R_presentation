<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Using   with  </title>
    <meta charset="utf-8" />
    <meta name="author" content="Maxime Jaunatre" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Using <svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"> <path d="M100.59 334.24c48.57 3.31 58.95 2.11 58.95 11.94 0 20-65.55 20.06-65.55 1.52.01-5.09 3.29-9.4 6.6-13.46zm27.95-116.64c-32.29 0-33.75 44.47-.75 44.47 32.51 0 31.71-44.47.75-44.47zM448 80v352a48 48 0 0 1-48 48H48a48 48 0 0 1-48-48V80a48 48 0 0 1 48-48h352a48 48 0 0 1 48 48zm-227 69.31c0 14.49 8.38 22.88 22.86 22.88 14.74 0 23.13-8.39 23.13-22.88S258.62 127 243.88 127c-14.48 0-22.88 7.84-22.88 22.31zM199.18 195h-49.55c-25-6.55-81.56-4.85-81.56 46.75 0 18.8 9.4 32 21.85 38.11C74.23 294.23 66.8 301 66.8 310.6c0 6.87 2.79 13.22 11.18 16.76-8.9 8.4-14 14.48-14 25.92C64 373.35 81.53 385 127.52 385c44.22 0 69.87-16.51 69.87-45.73 0-36.67-28.23-35.32-94.77-39.38l8.38-13.43c17 4.74 74.19 6.23 74.19-42.43 0-11.69-4.83-19.82-9.4-25.67l23.38-1.78zm84.34 109.84l-13-1.78c-3.82-.51-4.07-1-4.07-5.09V192.52h-52.6l-2.79 20.57c15.75 5.55 17 4.86 17 10.17V298c0 5.62-.31 4.58-17 6.87v20.06h72.42zM384 315l-6.87-22.37c-40.93 15.37-37.85-12.41-37.85-16.73v-60.72h37.85v-25.41h-35.82c-2.87 0-2 2.52-2-38.63h-24.18c-2.79 27.7-11.68 38.88-34 41.42v22.62c20.47 0 19.82-.85 19.82 2.54v66.57c0 28.72 11.43 40.91 41.67 40.91 14.45 0 30.45-4.83 41.38-10.2z"></path></svg> with <svg viewBox="0 0 581 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg"> <path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg>
]
.author[
### Maxime Jaunatre
]
.institute[
### LESSEM | INRAE
]
.date[
### 2022-12-01 (updated: 2022-12-01)
]

---







exclude: true

class: inverse, center, middle

# Introduction

---
class: inverse, center, middle

# Practice

&lt;!-- Ces slides présentent l'utilisation de Git avec Rstudio, Github Desktop, R et bien sur Git Bash qui est un terminal de commande. --&gt;

&lt;!-- Bien que tout ces outils permettent de faire des dépots Git et de commit, plus on va avancer, plus il deviendra pertinent d'utiliser le terminal. --&gt;

&lt;!-- Il est donc préférable de lire cette partie de [Happy git for Ruser](https://happygitwithr.com/shell.html) afin d'appréhender cet outils qui offre toute la puissance de git. --&gt;

&lt;!-- Afin de ne pas paniquer, une [cheatsheet](https://services.github.com/on-demand/downloads/github-git-cheat-sheet.pdf) est également disponible ici pour comprendre la plupart des options. --&gt;


---
# Config git account !

In Git Bash terminal :


```bash
$ git config --global user.name 'Maxime Jaunatre'
$ git config --global user.email 'myveryownmail@mail.com'
$ git config --global --list
```

Or using the `{usethis}` package in R terminal :


```r
## install if needed (do this exactly once):
## install.packages("usethis")
library(usethis)
use_git_config(user.name = "Maxime Jaunatre",
               user.email = "myveryownmail@mail.com")
```

This allow to sign the commits

---
# Initiate git

## Create a new folder (Rstudio project)

In Git Bash terminal :


```bash
$ cd
$ git init tuto_git
Initialized empty Git repository in path/to/your/directory/tuto/.git/
```

&lt;!-- Avec Github Desktop (GHD) : File &gt; New Repository &gt; Type name &gt; Create repository --&gt;

With Rstudio : File &gt; New Directory &gt; R project &gt; Type name + check "Create git repository"

---
# Initiate git

## You can also add git to an existing project

In Git Bash terminal :


```bash
$ cd path/to/directory
$ git init
Initialized empty Git repository in path/to/your/directory/tuto/.git/
```

In R terminal :


```r
usethis::use_git()
# Read the messages !
```

&lt;!-- Avec Github Desktop (GHD) : File &gt; New Repository &gt; Type name &gt; Create repository --&gt;

With Rstudio : Tools &gt; Project Options … &gt; Git/SVN. Under “Version control system”, choose “Git”. Confirm New Git Repository? Yes!


???

Basically the same thing but from an existing directory.


---
# Adding files to git repository

Once the file is saved (Ctrl+S), **git** will observe the change!

Check this in the Git tab or in the command terminal:


```bash
$ git status
```

We can also see that in the Git tab which indicates a small *A* next to our file.

???

We can set Rstudio to show the git bash terminal! And that's handy


---
# First commit

We can make our first commit!!!
It happens in 2 steps: add the files to the index and make the commit.

.pull-left[

**Git Bash**


```bash
$ git add Notes_Maxime.Rmd
$ git commit
```

This will open a text editor! (We can write whatever we want here.
]

.pull-right[

**Rstudio**

* Click on Commit

* Check the *Staged* box

* Write the commit
]

.pull-left[

**R**

```r
usethis::use_git(
  message = "Initial commit"
  )
# or
git2r::add(repo, "test.txt")
git2::commit(repo, "Commit message")
```
]

.pull-right[
&lt;img src="CSU_RepRo_files/figure-html/rstudio_commit.png" width="85%" style="display: block; margin: auto;" /&gt;
]


???

Tab allows auto completion of file names !

---
# Repeat the operation

Now we can modify the file and start again:

**Edit -&gt; Save -&gt; Add to index -&gt; Commit**

--

You can check the status with *Diff* and the history with *log*.

.pull-left[

**Git Bash**


```bash
$ git status
$ git diff
$ git log
```
]

.pull-right[
**Rstudio**

* Status -&gt; Diff

* log -&gt; Clock icon
]

.pull-left[

**R**

```r
git2r::status()
```
]

.pull-right[
&lt;img src="CSU_RepRo_files/figure-html/git_stage.png" width="85%" style="display: block; margin: auto;" /&gt;
]

Let's make some commits... Add some files to test!


---

class: inverse, center, middle

# Clone remote repository from github/gitlab

---
# Config Github Token (PAT) !

Github does not work anymore with passwords -&gt; security !

Create a token by going to [https://github.com/settings/tokens](https://github.com/settings/tokens) and -&gt; "Generate token".

Or in R :


```r
usethis::create_github_token()
```


Validate the boxes "repo", "user" and "workflow". Don't forget to copy the key !
It will be requested the next time you use git and need it.

You can even store it with R :


```r
gitcreds::gitcreds_set() # interactive command
```


---

# Clone a github repository

We will copy a remote repository to disk: **https://github.com/Ifremer-IAM/Tutorat_git**


.pull-left[

**Git Bash**


```bash
$ git clone &lt;URL&gt;
```
]

.pull-right[

**R**

For once R doesn't do everything...
]

.pull-left[
**Rstudio**

* File -&gt; New Project

* Version Control -&gt; Git

* URL : copy the url
]

.pull-right[
&lt;img src="CSU_RepRo_files/figure-html/clone_repo.png" width="85%" style="display: block; margin: auto;" /&gt;
]

--

[Happy Git for the useR](https://happygitwithr.com/usage-intro.html) explains other cases than this one.

???

Take the time for everyone to pull and commit, because there will be conflicts!

---

# Commit -&gt; Pull -&gt; Push
&lt;img src="git_exo_files/figure-html/diag-1.png" style="display: block; margin: auto;" /&gt;


---
# Create a new branch

.pull-left[

**Git Bash**


```bash
$ git checkout -b &lt;NOM&gt;
```
]

.pull-right[

**R**

```r
git2r::branch_create(name = &lt;NOM&gt;)
```
]


.pull-left[
**Rstudio**

* Onglet Git -&gt; Symbole violet
]

.pull-right[
&lt;img src="CSU_RepRo_files/figure-html/new_branch.png" width="85%" style="display: block; margin: auto;" /&gt;
]

---
# Navigate in the history

Once a certain number of commits have been defined, you can go back or change branches.

## Change branch

.pull-left[

**Git Bash**

You just have to give the name of the branch. We can list them as follows:


```bash
$ git branch
```

Switch to the *main* branch


```bash
$ git checkout main
```
]

.pull-right[
**Rstudio**

* Git tab -&gt; Next to the creation of branches you can choose which one to look at
]

You can change branches if all files are **committed** or ignored.


---
# Navigate in the history

Once a certain number of commits are defined, you can go back or change branches.

## Change commit

.pull-left[
**Git Bash**

You just have to give the SHA of the commit. We can list them as follows:


```bash
$ git log --oneline
$ git checkout &lt;SHA&gt;
```
]

.pull-right[
**Rstudio**

I haven't done this with Rstudio yet, if anyone finds it...


```r
# git2r::checkout()
```

]

You can change commits if all files are **commit** or ignored.

Another way to observe the past is to use **Github** which allows to easily visualize the history of a repository : see the article of [Happy Git for Ruser](https://happygitwithr.com/time-travel-see-past.html).

---
# Explanation

**git checkout** allows to move **HEAD**, which corresponds to what is presented on your computer.

.pull-left[
&lt;img src="git_exo_files/figure-html/head_act-1.png" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="git_exo_files/figure-html/head_branch-1.png" style="display: block; margin: auto;" /&gt;
]

--

.pull-left[
Reverting allows to see the state but you can also start a new branch re-commit from a past commit.
Example:


```bash
$ git checkout -b test A
$ git add ... ; git commit -m 'F'
```

]

.pull-right[
&lt;img src="git_exo_files/figure-html/head_past-1.png" style="display: block; margin: auto;" /&gt;
]

---
# Merging branches

Once the code is working we can do a **merge** of the branches.

.pull-left[
&lt;img src="git_exo_files/figure-html/branch_pre-1.png" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="git_exo_files/figure-html/branch_premerge-1.png" style="display: block; margin: auto;" /&gt;
]

.pull-left[
A merge is always done from the target branch (*main*) by incorporating the external branch (here *dev*)


```bash
$ git checkout main
$ git merge dev
```
]

.pull-right[
&lt;img src="git_exo_files/figure-html/branch merge-1.png" style="display: block; margin: auto;" /&gt;
]

In the case where each branch has commits, a new commit *merge* will be created with the opportunity to resolve conflicts. This commit belongs to both branches *main* and *dev*.

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"countIncrementalSlides": false,
"seal": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
